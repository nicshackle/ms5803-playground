<html>

<head>
    <script src="plotly-latest.min.js"></script>
    <script src="moment.js"></script>
    <script src="moment-timezone.js" type="application/javascript"></script>
</head>

<style>
    .temp {
        font-weight: bold;
        font-size: 72px;
        font-family: 'arial';
        color: #1b7d9a;
    }

    .tempsContainer{
        display: flex;
        flex-direction: row;
        width: 80%;
        justify-content: space-evenly;
    }

    .container {
        background-color: black;
        width: 100%;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    body {
        margin: 0;
        padding: 0;
    }
</style>

<body>
<div class="container">
    <div class="tempsContainer">
        <div class="temp" id="temp"></div>
        <div class="temp" id="maxTemp"></div>
        <div class="temp" id="minTemp"></div>
    </div>
    <div id="tempPlot" style="width:90%;height:400px;"></div>
    <div class="temp" id="pressure"></div>
    <div id="presPlot" style="width:90%;height:400px;"></div>
</div>

</body>

<script>
  console.log(moment().format('h:mma'))
  const update = () => fetch('/pt')
    .then(response => {
      return response.json()
    })
    .then(data => {
      // [{"timestamp":"2020-04-17T08:33:47.290Z","temp":25.62,"pressure":1014.2}]

      if(data.length < 1) throw 'No data'

      const maxTemp = Math.max(...data.map(entry => {return entry.temp}))
      const minTemp = Math.min(...data.map(entry => {return entry.temp}))
      const currentTemp = data[0].temp
      const currentPressure = data[0].pressure

      document.getElementById('temp').innerText = currentTemp + 'C'
      document.getElementById('maxTemp').innerText = 'max: ' + maxTemp + 'C'
      document.getElementById('minTemp').innerText = 'min: ' + minTemp + 'C'
      document.getElementById('pressure').innerText = currentPressure + 'hPa'

      const Ptrace = {
        x: data.map(entry => {return entry.timestamp}),
        y: data.map(entry => {return entry.pressure}),
        mode: 'lines',
        name: 'Pressure',
        type: 'scatter'
      }

      const Ttrace = {
        x: data.map(entry => {return entry.timestamp}),
        y: data.map(entry => {return entry.temp}),
        mode: 'lines',
        name: 'Temperature',
        type: 'scatter',
      }


      const layout = {
        plot_bgcolor: 'black',
        paper_bgcolor: 'black',
      }

      Plotly.newPlot('presPlot', [Ptrace], layout)
      Plotly.newPlot('tempPlot', [Ttrace], layout)
    })

  update()
  setInterval(update, 1000*60)
</script>

</html>
